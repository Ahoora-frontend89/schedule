<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>برنامه روزانه — تودو، نمودار و مدیریت داده</title>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{--purple:#6d28d9;--blue:#60a5fa;--light-blue:#eef6ff;--muted:#6b7280;}
*{box-sizing:border-box;font-family:'Vazirmatn',sans-serif}
body{margin:0;padding:18px;background:#fff;color:#1f1f39}
.container{max-width:980px;margin:0 auto;background:#fff;padding:20px;border-radius:12px;border:1px solid #f0f0f5;box-shadow:0 10px 30px rgba(100,100,200,0.06)}
h1{text-align:center;margin:0 0 12px;background:linear-gradient(90deg,#8b5cf6,#60a5fa);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.top-row{display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap}.cards{flex:1;min-width:280px}.chart-card{background:#fbfdff;border-radius:10px;padding:12px;border:1px solid #eef6ff}
.tabs{display:flex;flex-wrap:wrap;gap:6px;margin:10px 0}.tab{background:var(--light-blue);color:var(--purple);padding:6px 10px;border-radius:8px;cursor:pointer;border:1px solid #c7d2fe;user-select:none}.tab.active{background:linear-gradient(90deg,#8b5cf6,#60a5fa);color:#fff}
.day{display:none;margin-top:12px}.day.active{display:block}
.task{display:flex;align-items:center;justify-content:space-between;padding:8px;border-radius:10px;background:#f9fbff;border:1px solid #eef6ff;margin:6px 0}
.task .left{display:flex;align-items:center;gap:12px;direction:rtl}.task .time{font-weight:700;color:#0b3954;min-width:86px;text-align:left}.task.done{background:#eafbf0;text-decoration:line-through;color:#555}
.controls{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:12px;flex-wrap:wrap}
.btn{background:linear-gradient(90deg,#8b5cf6,#60a5fa);color:#fff;border:none;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700}.btn.ghost{background:#fff;color:var(--purple);border:1px solid #e6e6ff}
.small{font-size:13px;color:var(--muted)}
.progress-wrap{margin-top:18px;padding:10px;border-radius:10px;background:#f8fbff;border:1px solid #eef6ff}
.progress-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.progress-bar{height:14px;background:#e6f2ff;border-radius:10px;overflow:hidden}
.progress-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--blue),var(--purple));transition:width 700ms ease}
.footer-row{display:flex;justify-content:space-between;align-items:center;margin-top:14px;gap:8px;flex-wrap:wrap}
.clear-btn{background:#fff;border:1px solid #ffdddd;color:#b91c1c;padding:8px 12px;border-radius:8px;cursor:pointer}
.chart-section {width:100%;margin-top:24px;display:flex;flex-direction:column;gap:16px}.chart-card canvas{width:100% !important;height:auto !important;min-height:180px;max-height:240px}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:999;align-items:center;justify-content:center}.modal-inner{background:linear-gradient(135deg,#8b5cf6,#60a5fa);color:#fff;padding:22px;border-radius:14px;max-width:420px;text-align:center;box-shadow:0 12px 40px rgba(0,0,0,0.25)}
.modal-inner h2{margin:0 0 8px}.modal-inner p{margin:0 0 14px}.modal .btn{background:#fff;color:var(--purple)}
/* modal editor */
#modal-editor{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:1000;align-items:center;justify-content:center}
#modal-editor .modal-content{background:#fff;padding:20px;border-radius:12px;max-width:500px;width:90%;max-height:80%;overflow:auto;color:#000}
.task-edit{display:flex;gap:8px;align-items:center;margin-bottom:8px}.task-edit input{flex:1;padding:6px;border:1px solid #ccc;border-radius:6px}
</style>
</head>
<body>
<div class="container">
<h1>برنامه روزانه — تودو، نمودار و مدیریت داده</h1>
<div class="top-row">
<div class="cards" style="width:100%">
<div class="chart-card">
<div class="tabs" id="tabs"></div>
<div id="days"></div>
<div class="controls">

<div style="flex:1"></div>
<button class="btn ghost" id="reset-today-btn">ریست امروز</button>
<button class="btn" id="clear-all-btn">پاک کردن کامل داده‌ها</button>
<button class="btn" id="edit-tasks-btn">ویرایش تسک‌ها</button>
<button class="btn ghost" id="export-btn">صادرات داده</button>
</div>
</div>
</div>
</div>
<div class="chart-section">
<div class="chart-card">
<div class="small" style="margin-bottom:6px;font-weight:700">نمودار میله‌ای روزانه (٪ تکمیل)</div>
<canvas id="barChart"></canvas>
</div>
<div class="chart-card">
<div class="small" style="margin-bottom:6px;font-weight:700">نمودار خطی کل هفته (%)</div>
<canvas id="lineChart"></canvas>
</div>
</div>
<div class="progress-wrap" style="margin-top:16px">
<div class="progress-header">
<div class="progress-label">پیشرفت هفتگی: <span id="points">0</span> / 700 امتیاز</div>
<div class="small" id="percent">0%</div>
</div>
<div class="progress-bar">
<div class="progress-fill" id="progress-fill"></div>
</div>
</div>
<div class="footer-row">
<div class="small">هر تسک = 10 امتیاز. هفته کامل = 700 امتیاز.</div>
</div>
</div>
<div id="modal" class="modal" onclick="closeModal()">
<div class="modal-inner" onclick="event.stopPropagation()">
<h2 id="modal-title">🎉</h2>
<p id="modal-text"></p>
<button class="btn" onclick="closeModal()">باشه</button>
</div>
</div>
<div id="modal-editor" class="modal">
<div class="modal-content">
<h3>ویرایش تسک‌ها</h3>
<div id="tasks-edit-list"></div>
<div style="margin-top:10px;">
<button id="add-edit-task" class="btn ghost">➕ افزودن تسک</button>
<button id="save-edit-tasks" class="btn">ذخیره تغییرات</button>
<button id="cancel-edit-tasks" class="btn ghost">انصراف</button>
</div>
</div>
</div>
<script>
const dayNames = ['شنبه','یکشنبه','دوشنبه','سه‌شنبه','چهارشنبه','پنج‌شنبه','جمعه'];
const daysCfg = [
{name:'شنبه', school:true, end:'14:30'},
{name:'یکشنبه', school:true, end:'14:30'},
{name:'دوشنبه', school:true, end:'14:30'},
{name:'سه‌شنبه', school:true, end:'13:00'},
{name:'چهارشنبه', school:true, end:'13:00'},
{name:'پنج‌شنبه', school:false},
{name:'جمعه', school:false}
];

function tasksTemplate(day){
return [
{id:Date.now(),time:'06:00',text:'بیدار شدن و آماده شدن برای روز'},
{id:Date.now()+1,time:'07:15',text:'رفتن به مدرسه'},
...(day.school ? [{id:Date.now()+2,time:`08:00-${day.end}`,text:'مدرسه و کلاس‌ها'}] : [{id:Date.now()+2,time:'08:00-09:30',text:'مطالعه در منزل'}]),
{id:Date.now()+3,time: day.school ? `${day.end}-15:30` : '09:30-10:00',text:'استراحت / ناهار / عصرانه'},
{id:Date.now()+4,time:'15:30-17:00',text:'مرور دروس و انجام تکالیف'},
{id:Date.now()+5,time:'17:00-18:00',text:'کدنویسی و تمرین الگوریتم'},
{id:Date.now()+6,time:'18:00-18:30',text:'ورزش یا مدیتیشن'},
{id:Date.now()+7,time:'18:30-19:30',text:'مطالعه آزاد یا المپیاد'},
{id:Date.now()+8,time:'19:30-20:00',text:'شام و استراحت'},
{id:Date.now()+9,time:'20:00-21:00',text:'مرور انگلیسی یا تست کوتاه'},
{id:Date.now()+10,time:'21:00-21:30',text:'کتاب‌خوانی / نوشتن خاطرات'},
{id:Date.now()+11,time:'22:00',text:'آماده شدن برای خواب'}
];
}

function getTasks(dayName){
  const saved = localStorage.getItem(`tasks-${dayName}`);
  if (saved) return JSON.parse(saved);
  const day = daysCfg.find(d=>d.name===dayName);
  return tasksTemplate(day);
}
function saveTasks(dayName,tasks){
  localStorage.setItem(`tasks-${dayName}`,JSON.stringify(tasks));
}

function buildUI(){
  const tabsEl=document.getElementById('tabs');
  const daysEl=document.getElementById('days');
  tabsEl.innerHTML='';
  daysEl.innerHTML='';
  const tIndex = todayIndex();

  for(let i=0;i<daysCfg.length;i++){
    const day=daysCfg[i];
    const tab=document.createElement('div');
    tab.className='tab'+(i===tIndex?' active':'');
    tab.innerText=day.name;
    tab.addEventListener('click',()=>{
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      document.querySelectorAll('.day').forEach(d=>d.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById(`day-${i}`).classList.add('active');
    });
    tabsEl.appendChild(tab);

    const dayWrap=document.createElement('div');
    dayWrap.className='day'+(i===tIndex?' active':'');
    dayWrap.id=`day-${i}`;

    const tasks=getTasks(day.name);
    tasks.forEach(t=>{
      const row=document.createElement('div');
      row.className='task';
      const key=`task-${day.name}-${t.id}`;
      const done=localStorage.getItem(key)==='1';
      if(done)row.classList.add('done');

      const left=document.createElement('div');
      left.className='left';

      const info=document.createElement('div');
      info.className='info';
      // ✅ زمان اختیاری
      info.innerHTML=`
        <div class="time">${t.time ? t.time : ''}</div>
        <div class="desc">${t.text}</div>
      `;

      const cb=document.createElement('input');
      cb.type='checkbox';
      cb.checked=done;
      cb.onchange=()=>{
        if(cb.checked){
          row.classList.add('done');
          localStorage.setItem(key,'1');
        }else{
          row.classList.remove('done');
          localStorage.removeItem(key);
        }
        updateCharts();
      };

      left.appendChild(info);
      row.appendChild(left);
      row.appendChild(cb);
      dayWrap.appendChild(row);
    });
    daysEl.appendChild(dayWrap);
  }

  initCharts();
  updateCharts();
}

function todayIndex(){
  const jsDay=new Date().getDay();
  return (jsDay+1)%7;
}

// ------------------- Modal editor -------------------
const editModal=document.getElementById('modal-editor');
document.getElementById('edit-tasks-btn').onclick=()=>{
  const active=document.querySelector('.tab.active');
  const dayName=active.innerText;
  const tasks=getTasks(dayName);
  const list=document.getElementById('tasks-edit-list');
  list.innerHTML='';
  tasks.forEach(t=>addTaskEditRow(t));
  editModal.style.display='flex';
};

function addTaskEditRow(task){
  const list=document.getElementById('tasks-edit-list');
  const row=document.createElement('div');
  row.className='task-edit';
  row.dataset.id=task.id;
  // ✅ ورودی زمان می‌تواند خالی باشد
  row.innerHTML=`
    <input type="time" value="${task.time || ''}">
    <input type="text" value="${task.text}">
    <button class='btn ghost'>❌</button>
  `;
  row.querySelector('button').onclick=()=>row.remove();
  list.appendChild(row);
}

document.getElementById('add-edit-task').onclick=()=>addTaskEditRow({id:Date.now(),time:'',text:''});
document.getElementById('cancel-edit-tasks').onclick=()=>editModal.style.display='none';

document.getElementById('save-edit-tasks').onclick=()=>{
  const active=document.querySelector('.tab.active');
  const dayName=active.innerText;
  const rows=document.querySelectorAll('#tasks-edit-list .task-edit');
  const newTasks=[];
  rows.forEach(r=>{
    const id=parseInt(r.dataset.id);
    const time=r.querySelector('input[type="time"]').value;
    const text=r.querySelector('input[type="text"]').value;
    // ✅ فقط متن الزامی است، زمان اختیاری
    if(text.trim()) newTasks.push({id,time:time || '',text});
  });
  saveTasks(dayName,newTasks);
  editModal.style.display='none';
  buildUI();
};

// ------------------- کنترل‌ها -------------------
document.getElementById('reset-today-btn').onclick=()=>{
  const ti=todayIndex();
  const day=daysCfg[ti];
  const tasks=getTasks(day.name);
  tasks.forEach(t=>localStorage.removeItem(`task-${day.name}-${t.id}`));
  updateCharts();
  buildUI();
};

document.getElementById('clear-all-btn').onclick=()=>{
  if(confirm('پاک کردن همه داده‌ها؟')){
    localStorage.clear();
    buildUI();
    updateCharts();
  }
};

document.getElementById('export-btn').onclick=()=>{
  const data={};
  daysCfg.forEach(d=>data[d.name]=getTasks(d.name));
  navigator.clipboard.writeText(JSON.stringify(data,null,2));
  alert('داده‌ها کپی شدند.');
};

// ------------------- نمودارها -------------------
let barChart=null,lineChart=null;
function initCharts(){
  const barCtx=document.getElementById('barChart').getContext('2d');
  const lineCtx=document.getElementById('lineChart').getContext('2d');
  const options={responsive:true,scales:{y:{beginAtZero:true,max:100}},plugins:{legend:{display:false}}};
  barChart=new Chart(barCtx,{type:'bar',data:{labels:dayNames,datasets:[{label:'درصد تکمیل روز',data:Array(7).fill(0),backgroundColor:dayNames.map((_,i)=>`rgba(${96+i*6},${165-i*4},${250-i*8},0.9)`),borderRadius:6,borderSkipped:false}]},options});
  lineChart=new Chart(lineCtx,{type:'line',data:{labels:dayNames,datasets:[{label:'پیشرفت هفتگی (%)',data:Array(7).fill(0),borderColor:'rgba(107,43,255,0.95)',backgroundColor:'rgba(96,165,250,0.18)',tension:0.35,fill:true,pointRadius:4,pointHoverRadius:6}]},options});
}

function updateCharts(){
  let points=0;
  daysCfg.forEach((day,i)=>{
    getTasks(day.name).forEach(t=>{
      if(localStorage.getItem(`task-${day.name}-${t.id}`)==='1') points+=10;
    });
  });
  document.getElementById('points').innerText=points;
  const percent=Math.round(Math.min(100,(points/700)*100));
  document.getElementById('percent').innerText=percent+'%';
  document.getElementById('progress-fill').style.width=percent+'%';
}

// ------------------- Init -------------------
buildUI();
initCharts();
updateCharts();
</script>

</body>
</html>