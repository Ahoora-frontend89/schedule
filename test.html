<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÙˆØ²Ø§Ù†Ù‡ â€” ØªÙˆØ¯ÙˆØŒ Ù†Ù…ÙˆØ¯Ø§Ø± Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{
      --purple:#6d28d9;
      --blue:#60a5fa;
      --light-blue:#eef6ff;
      --muted:#6b7280;
    }
    *{box-sizing:border-box;font-family:'Vazirmatn',sans-serif}
    body{margin:0;padding:18px;background:#fff;color:#1f1f39}
    .container{max-width:980px;margin:0 auto;background:#fff;padding:20px;border-radius:12px;border:1px solid #f0f0f5;box-shadow:0 10px 30px rgba(100,100,200,0.06)}
    h1{text-align:center;margin:0 0 12px;background:linear-gradient(90deg,#8b5cf6,#60a5fa);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .top-row{display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap}
    .cards{flex:1;min-width:280px}
    .chart-card{background:#fbfdff;border-radius:10px;padding:12px;border:1px solid #eef6ff}
    .tabs{display:flex;flex-wrap:wrap;gap:6px;margin:10px 0}
    .tab{background:var(--light-blue);color:var(--purple);padding:6px 10px;border-radius:8px;cursor:pointer;border:1px solid #c7d2fe;user-select:none}
    .tab.active{background:linear-gradient(90deg,#8b5cf6,#60a5fa);color:#fff}
    .day{display:none;margin-top:12px}
    .day.active{display:block}
    .task{display:flex;align-items:center;justify-content:space-between;padding:8px;border-radius:10px;background:#f9fbff;border:1px solid #eef6ff;margin:6px 0}
    .task .left{display:flex;align-items:center;gap:12px;direction:rtl}
    .task .time{font-weight:700;color:#0b3954;min-width:86px;text-align:left}
    .task.done{background:#eafbf0;text-decoration:line-through;color:#555}
    .controls{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:12px;flex-wrap:wrap}
    .btn{background:linear-gradient(90deg,#8b5cf6,#60a5fa);color:#fff;border:none;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700}
    .btn.ghost{background:#fff;color:var(--purple);border:1px solid #e6e6ff}
    .small{font-size:13px;color:var(--muted)}
    .progress-wrap{margin-top:18px;padding:10px;border-radius:10px;background:#f8fbff;border:1px solid #eef6ff}
    .progress-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .progress-bar{height:14px;background:#e6f2ff;border-radius:10px;overflow:hidden}
    .progress-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--blue),var(--purple));transition:width 700ms ease}
    .footer-row{display:flex;justify-content:space-between;align-items:center;margin-top:14px;gap:8px;flex-wrap:wrap}
    .clear-btn{background:#fff;border:1px solid #ffdddd;color:#b91c1c;padding:8px 12px;border-radius:8px;cursor:pointer}

    /* Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ Ø¯Ø± Ù¾Ø§ÛŒÛŒÙ† */
    .chart-section {
      width: 100%;
      margin-top: 24px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .chart-card canvas {
      width: 100% !important;
      height: auto !important;
      min-height: 180px;
      max-height: 240px;
    }

    /* modal */
    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:999;align-items:center;justify-content:center}
    .modal-inner{background:linear-gradient(135deg,#8b5cf6,#60a5fa);color:#fff;padding:22px;border-radius:14px;max-width:420px;text-align:center;box-shadow:0 12px 40px rgba(0,0,0,0.25)}
    .modal-inner h2{margin:0 0 8px}
    .modal-inner p{margin:0 0 14px}
    .modal .btn{background:#fff;color:var(--purple)}

    /* responsive tweaks */
    @media (max-width:900px){
      .top-row{flex-direction:column}
      .task .time{min-width:70px}
    }
    @media (max-width:600px){
      .chart-card canvas {
        min-height: 160px;
      }
      .chart-card .small {
        font-size: 12px;
      }
    }
    @media (max-width:520px){
      body{padding:10px}
      .task{padding:6px}
      .task .time{display:block;width:100%;text-align:right}
      .task .left{flex-direction:column;align-items:flex-end;gap:6px}
      .tab{padding:6px 8px;font-size:13px}
    }
    @media (max-width:400px){
      .chart-card canvas {
        min-height: 140px;
      }
      .task .time{font-size:12px}
      .desc{font-size:13px}
    }
    @media print{.modal{display:none}.btn,.clear-btn{display:none}}
  </style>
</head>
<body>
  <div class="container">
    <h1>Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÙˆØ²Ø§Ù†Ù‡ â€” ØªÙˆØ¯ÙˆØŒ Ù†Ù…ÙˆØ¯Ø§Ø± Ù…ÛŒÙ„Ù‡â€ŒØ§ÛŒ/Ø®Ø·ÛŒ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª</h1>

    <!-- Ø¨Ø®Ø´ ØªØ³Ú©â€ŒÙ‡Ø§ (Ø¯Ø± Ø¨Ø§Ù„Ø§) -->
    <div class="top-row">
      <div class="cards" style="width:100%">
        <div class="chart-card">
          <div class="tabs" id="tabs"></div>
          <div id="days"></div>

          <div class="controls">
            <div class="small">Ø§Ù…Ø±ÙˆØ²: <span id="today-name">â€”</span> &nbsp; | &nbsp; ØªØ§Ø±ÛŒØ®: <span id="today-date">â€”</span></div>
            <div style="flex:1"></div>
            <button class="btn ghost" id="reset-today-btn" title="Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªÛŒÚ©â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ² (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)">Ø±ÛŒØ³Øª Ø§Ù…Ø±ÙˆØ²</button>
            <button class="btn" id="clear-all-btn" title="Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ø§Ù…Ù„ Ù‡Ù…Ù‡â€ŒÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ø§Ù…Ù„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ Ø¯Ø± Ù¾Ø§ÛŒÛŒÙ† -->
    <div class="chart-section">
      <div class="chart-card">
        <div class="small" style="margin-bottom:6px;font-weight:700">Ù†Ù…ÙˆØ¯Ø§Ø± Ù…ÛŒÙ„Ù‡â€ŒØ§ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡ (Ùª ØªÚ©Ù…ÛŒÙ„)</div>
        <canvas id="barChart"></canvas>
      </div>

      <div class="chart-card">
        <div class="small" style="margin-bottom:6px;font-weight:700">Ù†Ù…ÙˆØ¯Ø§Ø± Ø®Ø·ÛŒ Ú©Ù„ Ù‡ÙØªÙ‡ (%)</div>
        <canvas id="lineChart"></canvas>
      </div>
    </div>

    <div class="progress-wrap" style="margin-top:16px">
      <div class="progress-header">
        <div class="progress-label">Ù¾ÛŒØ´Ø±ÙØª Ù‡ÙØªÚ¯ÛŒ: <span id="points">0</span> / 700 Ø§Ù…ØªÛŒØ§Ø²</div>
        <div class="small" id="percent">0%</div>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progress-fill"></div>
      </div>
    </div>

    <div class="footer-row">
      <div class="small">Ù‡Ø± ØªØ³Ú© = 10 Ø§Ù…ØªÛŒØ§Ø². Ù‡ÙØªÙ‡ Ú©Ø§Ù…Ù„ = 700 Ø§Ù…ØªÛŒØ§Ø².</div>
      <div><button id="export-btn" class="btn ghost">ØµØ§Ø¯Ø±Ø§Øª Ø¯Ø§Ø¯Ù‡ (Ú©Ù¾ÛŒ JSON)</button></div>
    </div>

  </div>

  <!-- modal -->
  <div id="modal" class="modal" onclick="closeModal()">
    <div class="modal-inner" onclick="event.stopPropagation()">
      <h2 id="modal-title">ğŸ‰</h2>
      <p id="modal-text"></p>
      <button class="btn" onclick="closeModal()">Ø¨Ø§Ø´Ù‡</button>
    </div>
  </div>

  <script>
  // --------------------
  // Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ localStorage Ù…ÙˆØ±Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡:
  // - task-{DayName}-{idx}    => 'true' Ø¨Ø±Ø§ÛŒ ØªØ³Ú© ØªÛŒÚ© Ø®ÙˆØ±Ø¯Ù‡
  // - complete-{DayName}      => 'true' ÙˆÙ‚ØªÛŒ Ø±ÙˆØ² Ú©Ø§Ù…Ù„ Ø´Ø¯ (Ø¨Ø±Ø§ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø±)
  // - chart-daily-data        => JSON Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ø§ 7 Ù…Ù‚Ø¯Ø§Ø± Ø¯Ø±ØµØ¯ Ø±ÙˆØ²Ù‡Ø§ (Ø´Ù†Ø¨Ù‡..Ø¬Ù…Ø¹Ù‡)
  // - lastDate                => YYYY-MM-DD ØªØ§Ø±ÛŒØ® Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø§Ø²Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ø±ÙˆØ² Ø¬Ø¯ÛŒØ¯
  // --------------------

  const dayNames = ['Ø´Ù†Ø¨Ù‡','ÛŒÚ©Ø´Ù†Ø¨Ù‡','Ø¯ÙˆØ´Ù†Ø¨Ù‡','Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡','Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡','Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡','Ø¬Ù…Ø¹Ù‡'];
  const daysCfg = [
    {name:'Ø´Ù†Ø¨Ù‡', school:true, end:'14:30'},
    {name:'ÛŒÚ©Ø´Ù†Ø¨Ù‡', school:true, end:'14:30'},
    {name:'Ø¯ÙˆØ´Ù†Ø¨Ù‡', school:true, end:'14:30'},
    {name:'Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡', school:true, end:'13:00'},
    {name:'Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡', school:true, end:'13:00'},
    {name:'Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡', school:false},
    {name:'Ø¬Ù…Ø¹Ù‡', school:false}
  ];

  // Ù‚Ø§Ù„Ø¨ ØªØ³Ú©â€ŒÙ‡Ø§ (ØªØ§Ø¨Ø¹) â€” Ù‡Ø± Ø±ÙˆØ² ÛŒÚ© Ø¢Ø±Ø§ÛŒÙ‡ Ø§Ø² ØªØ³Ú©â€ŒÙ‡Ø§
  function tasksTemplate(day){
    return [
      {time:'06:00', text:'Ø¨ÛŒØ¯Ø§Ø± Ø´Ø¯Ù† Ùˆ Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯Ù† Ø¨Ø±Ø§ÛŒ Ø±ÙˆØ²'},
      {time:'07:15', text:'Ø±ÙØªÙ† Ø¨Ù‡ Ù…Ø¯Ø±Ø³Ù‡'},
      ...(day.school ? [{time:`08:00-${day.end}`, text:'Ù…Ø¯Ø±Ø³Ù‡ Ùˆ Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§'}] : [{time:'08:00-09:30', text:'Ù…Ø·Ø§Ù„Ø¹Ù‡ Ø¯Ø± Ù…Ù†Ø²Ù„'}]),
      {time: day.school ? `${day.end}-15:30` : '09:30-10:00', text:'Ø§Ø³ØªØ±Ø§Ø­Øª / Ù†Ø§Ù‡Ø§Ø± / Ø¹ØµØ±Ø§Ù†Ù‡'},
      {time:'15:30-17:00', text:'Ù…Ø±ÙˆØ± Ø¯Ø±ÙˆØ³ Ùˆ Ø§Ù†Ø¬Ø§Ù… ØªÚ©Ø§Ù„ÛŒÙ'},
      {time:'17:00-18:00', text:'Ú©Ø¯Ù†ÙˆÛŒØ³ÛŒ Ùˆ ØªÙ…Ø±ÛŒÙ† Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ…'},
      {time:'18:00-18:30', text:'ÙˆØ±Ø²Ø´ ÛŒØ§ Ù…Ø¯ÛŒØªÛŒØ´Ù†'},
      {time:'18:30-19:30', text:'Ù…Ø·Ø§Ù„Ø¹Ù‡ Ø¢Ø²Ø§Ø¯ ÛŒØ§ Ø§Ù„Ù…Ù¾ÛŒØ§Ø¯'},
      {time:'19:30-20:00', text:'Ø´Ø§Ù… Ùˆ Ø§Ø³ØªØ±Ø§Ø­Øª'},
      {time:'20:00-21:00', text:'Ù…Ø±ÙˆØ± Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ ÛŒØ§ ØªØ³Øª Ú©ÙˆØªØ§Ù‡'},
      {time:'21:00-21:30', text:'Ú©ØªØ§Ø¨â€ŒØ®ÙˆØ§Ù†ÛŒ / Ù†ÙˆØ´ØªÙ† Ø®Ø§Ø·Ø±Ø§Øª'},
      {time:'22:00', text:'Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯Ù† Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ø¨'}
    ];
  }

  // Ø®ÙˆØ§Ù†Ø¯Ù†/Ù†ÙˆØ´ØªÙ† chart daily data
  function readChartData(){
    const raw = localStorage.getItem('chart-daily-data');
    if(!raw) return Array(7).fill(0);
    try{ const arr = JSON.parse(raw); if(Array.isArray(arr) && arr.length===7) return arr; }catch(e){}
    return Array(7).fill(0);
  }
  function writeChartData(arr){ localStorage.setItem('chart-daily-data', JSON.stringify(arr)); }

  // Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªØ§Ø±ÛŒØ® Ø§Ù…Ø±ÙˆØ² Ø¨Ù‡ ØµÙˆØ±Øª YYYY-MM-DD
  function todayKey(){
    const d = new Date();
    const y = d.getFullYear(), m = String(d.getMonth()+1).padStart(2,'0'), dd = String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${dd}`;
  }

  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù†Ø¯ÛŒØ³ Ø§Ù…Ø±ÙˆØ² Ø¨Ù‡ ØµÙˆØ±Øª Ø´Ù†Ø¨Ù‡=0...Ø¬Ù…Ø¹Ù‡=6 (Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± JS: Sun=0..Sat=6)
  function todayIndex(){
    const jsDay = new Date().getDay(); // Sun=0 .. Sat=6
    return (jsDay + 1) % 7;
  }

  // Ø§Ú¯Ø± Ø±ÙˆØ² ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡ Ø¨Ø§Ø´Ø¯: Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø±ØµØ¯ Ø±ÙˆØ² Ù‚Ø¨Ù„ Ø¯Ø± chart-daily-data (Ø§Ú¯Ø± Ù¾Ø± Ù†Ø´Ø¯Ù‡) Ùˆ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªÛŒÚ©â€ŒÙ‡Ø§ÛŒ Ø¢Ù† Ø±ÙˆØ²
  function handleDayBoundary(){
    const last = localStorage.getItem('lastDate');
    const today = todayKey();
    if(last && last !== today){
      const lastDate = new Date(last);
      const lastJsDay = lastDate.getDay();
      const lastIndex = (lastJsDay + 1) % 7;
      const chart = readChartData();
      if(chart[lastIndex] === 0){
        const dayCfg = daysCfg[lastIndex];
        const tasks = tasksTemplate(dayCfg);
        const total = tasks.length;
        let done = 0;
        tasks.forEach((t, idx) => { if(localStorage.getItem(`${dayCfg.name}-${idx}`) === 'true') done++; });
        const percent = Math.round((done / total) * 100);
        chart[lastIndex] = percent;
        writeChartData(chart);
      }
      const prevDayCfg = daysCfg[lastIndex];
      const prevTasks = tasksTemplate(prevDayCfg);
      prevTasks.forEach((t, idx) => localStorage.removeItem(`${prevDayCfg.name}-${idx}`));
    }
    localStorage.setItem('lastDate', today);
  }

  // Ø³Ø§Ø®Øª UI ØªØ¨â€ŒÙ‡Ø§ Ùˆ Ø±ÙˆØ²Ù‡Ø§
  const tabsEl = document.getElementById('tabs');
  const daysEl = document.getElementById('days');
  const tIndex = todayIndex();
  document.getElementById('today-name').innerText = dayNames[tIndex];
  document.getElementById('today-date').innerText = (new Date()).toLocaleDateString();

  function buildUI(){
    tabsEl.innerHTML = ''; daysEl.innerHTML='';
    const chartData = readChartData();

    daysCfg.forEach((day, i) => {
      const tab = document.createElement('div');
      tab.className = 'tab' + (i===tIndex ? ' active' : '');
      tab.innerText = day.name;
      tabsEl.appendChild(tab);

      const dayWrap = document.createElement('div');
      dayWrap.className = 'day' + (i===tIndex ? ' active' : '');
      const tasks = tasksTemplate(day);
      tasks.forEach((task, idx) => {
        const row = document.createElement('div');
        row.className = 'task';
        const key = `${day.name}-${idx}`;
        const done = localStorage.getItem(key) === 'true';
        if(done) row.classList.add('done');
        const left = document.createElement('div'); left.className='left';
        const info = document.createElement('div'); info.className='info';
        info.innerHTML = `<div class="time">${task.time}</div><div class="desc">${task.text}</div>`;
        const cb = document.createElement('input'); cb.type='checkbox'; cb.checked = !!done;
        cb.onchange = () => {
          if(cb.checked){ row.classList.add('done'); localStorage.setItem(key,'true'); }
          else { row.classList.remove('done'); localStorage.removeItem(key); }
          updateDayCompletion(day.name, i);
          updateCharts();
          checkAchievements();
        };
        left.appendChild(info);
        row.appendChild(left);
        row.appendChild(cb);
        dayWrap.appendChild(row);
      });

      daysEl.appendChild(dayWrap);

      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        document.querySelectorAll('.day').forEach(d=>d.classList.remove('active'));
        tab.classList.add('active'); dayWrap.classList.add('active');
      });
    });

    initCharts();
    updateCharts();
  }

  // update completion percent for a specific day index and persist into chart-daily-data
  function updateDayCompletion(dayName, dayIndex){
    const dayCfg = daysCfg[dayIndex];
    const tasks = tasksTemplate(dayCfg);
    const total = tasks.length;
    let done = 0;
    tasks.forEach((t, idx)=>{ if(localStorage.getItem(`${dayCfg.name}-${idx}`)==='true') done++; });
    const percent = Math.round((done/total)*100);
    const chart = readChartData();
    chart[dayIndex] = percent;
    writeChartData(chart);
    if(percent === 100) localStorage.setItem(`complete-${dayCfg.name}`,'true');
    else localStorage.removeItem(`complete-${dayCfg.name}`);
  }

  // --------------------------------------------------
  // Charts (Chart.js): barChart (daily %) and lineChart (weekly)
  // --------------------------------------------------
  let barChart=null, lineChart=null;
  function initCharts(){
    const barCtx = document.getElementById('barChart').getContext('2d');
    const lineCtx = document.getElementById('lineChart').getContext('2d');

    const chartOptions = {
      responsive: true,
      aspectRatio: 2.5,
      scales: {
        y: { beginAtZero: true, max: 100, ticks: { stepSize: 20 } }
      },
      plugins: { legend: { display: false } }
    };

    barChart = new Chart(barCtx, {
      type: 'bar',
      data: {
        labels: dayNames,
        datasets: [{
          label: 'Ø¯Ø±ØµØ¯ ØªÚ©Ù…ÛŒÙ„ Ø±ÙˆØ²',
          data: readChartData(),
          backgroundColor: dayNames.map((_,i) => `rgba(${96 + i*6}, ${165 - i*4}, ${250 - i*8}, 0.9)`),
          borderRadius: 6,
          borderSkipped: false
        }]
      },
      options: {
        ...chartOptions,
        plugins: {
          tooltip: { callbacks: { label: ctx => `${ctx.parsed.y}%` } }
        },
        indexAxis: 'x',
        barPercentage: 0.8,
        categoryPercentage: 0.9
      }
    });

    lineChart = new Chart(lineCtx, {
      type: 'line',
      data: {
        labels: dayNames,
        datasets: [{
          label: 'Ù¾ÛŒØ´Ø±ÙØª Ù‡ÙØªÚ¯ÛŒ (%)',
          data: readChartData(),
          borderColor: 'rgba(107,43,255,0.95)',
          backgroundColor: 'rgba(96,165,250,0.18)',
          tension: 0.35,
          fill: true,
          pointRadius: 4,
          pointHoverRadius: 6
        }]
      },
      options: {
        ...chartOptions,
        plugins: { legend: { display: false } },
        scales: {
          y: { beginAtZero: true, max: 100 },
          x: {
            ticks: {
              autoSkip: false,
              maxRotation: 0,
              minRotation: 0,
              font: { size: window.innerWidth < 500 ? 11 : 12 }
            }
          }
        }
      }
    });
  }

  function updateCharts(){
    const data = readChartData();
    if(barChart){
      barChart.data.datasets[0].data = data;
      barChart.update();
    }
    if(lineChart){
      lineChart.data.datasets[0].data = data;
      lineChart.update();
    }
    let points = 0;
    daysCfg.forEach((day, i) => {
      const tasks = tasksTemplate(day);
      tasks.forEach((t, idx) => { if(localStorage.getItem(`${day.name}-${idx}`) === 'true') points += 10; });
    });
    const max = 700;
    const percent = Math.round(Math.min(100, (points/max)*100));
    document.getElementById('points').innerText = points;
    document.getElementById('percent').innerText = percent + '%';
    document.getElementById('progress-fill').style.width = percent + '%';
  }

  // Achievements
  function checkAchievements(){
    const ti = todayIndex();
    const chart = readChartData();
    if(chart[ti] === 100 && !localStorage.getItem(`modal-daily-${dayNames[ti]}`)){
      localStorage.setItem(`modal-daily-${dayNames[ti]}`,'shown');
      openModal('daily');
    }
    for(let s=0;s<=4;s++){
      const chart = readChartData();
      if(chart[s]===100 && chart[s+1]===100 && chart[s+2]===100 && !localStorage.getItem(`3day-awarded-${s}`)){
        localStorage.setItem(`3day-awarded-${s}`,'true');
        openModal('3day');
      }
    }
    const chartAll = readChartData();
    if(chartAll.every(v=>v===100) && !localStorage.getItem('weekly-awarded')){
      localStorage.setItem('weekly-awarded','true');
      openModal('weekly');
    }
  }

  function openModal(type){
    const modal = document.getElementById('modal');
    const t = document.getElementById('modal-title');
    const txt = document.getElementById('modal-text');
    if(type==='daily'){ t.innerText='ğŸ‰ ØªØ¨Ø±ÛŒÚ© Ø±ÙˆØ²Ø§Ù†Ù‡!'; txt.innerHTML='ØªÙ…Ø§Ù… ØªØ³Ú©â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ² Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯ÛŒ.<br>Ù¾Ø§Ø¯Ø§Ø´: Û±Û° Ø¯Ù‚ÛŒÙ‚Ù‡ ÙÛŒÙ„Ù… Ø§Ù†Ú¯ÛŒØ²Ø´ÛŒ.'; }
    else if(type==='3day'){ t.innerText='ğŸŒŸ Ø³Ù‡ Ø±ÙˆØ² Ø¹Ø§Ù„ÛŒ!'; txt.innerHTML='Ø³Ù‡ Ø±ÙˆØ² Ù¾ÛŒØ§Ù¾ÛŒ Ù‡Ù…Ù‡ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯ÛŒ â€” ØªØ´ÙˆÛŒÙ‚: "ØªØ´ÙˆÛŒÙ‚"'; }
    else if(type==='weekly'){ t.innerText='ğŸ† Ù‡ÙØªÙ‡ Ø·Ù„Ø§ÛŒÛŒ!'; txt.innerHTML='Ú©Ù„ Ù‡ÙØªÙ‡ Ø±Ø§ Ú©Ø§Ù…Ù„ Ú©Ø±Ø¯ÛŒ â€” ØªØ´ÙˆÛŒÙ‚ Ø¨Ø²Ø±Ú¯: "ØªØ´ÙˆÛŒÙ‚"'; }
    modal.style.display='flex';
  }
  function closeModal(){ document.getElementById('modal').style.display='none'; }

  // reset today
  document.getElementById('reset-today-btn').addEventListener('click', ()=>{
    if(!confirm('Ø±ÛŒØ³Øª ØªÛŒÚ©â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ² Ø§Ù†Ø¬Ø§Ù… Ø´ÙˆØ¯ØŸ (Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ Ùˆ Ø¢Ù…Ø§Ø± Ø­ÙØ¸ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯)')) return;
    const ti = todayIndex();
    const dayCfg = daysCfg[ti];
    tasksTemplate(dayCfg).forEach((t,idx)=> localStorage.removeItem(`${dayCfg.name}-${idx}`));
    const chart = readChartData(); chart[ti]=0; writeChartData(chart);
    updateCharts();
    buildUI();
  });

  // clear all data
  document.getElementById('clear-all-btn').addEventListener('click', ()=>{
    if(!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒ Ù‡Ù…Ù‡Ù” Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ (ØªØ³Ú©â€ŒÙ‡Ø§ Ùˆ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§) Ù¾Ø§Ú© Ø´ÙˆÙ†Ø¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª.')) return;
    Object.keys(localStorage).forEach(k=>{
      if(k.startsWith('chart-daily-data') || k.startsWith('complete-') || k.startsWith('modal-') || k.startsWith('3day-') || k.startsWith('weekly-') || k.includes('-') ){
        localStorage.removeItem(k);
      }
    });
    localStorage.removeItem('chart-daily-data');
    localStorage.removeItem('lastDate');
    buildUI();
    updateCharts();
    alert('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯.');
  });

  // export data
  document.getElementById('export-btn').addEventListener('click', ()=>{
    const data = {};
    Object.keys(localStorage).forEach(k=> data[k]=localStorage.getItem(k));
    const s = JSON.stringify(data, null, 2);
    navigator.clipboard?.writeText(s).then(()=> alert('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯ Ú©Ù¾ÛŒ Ø´Ø¯ (ÙØ±Ù…Øª JSON).'), ()=> alert('Ú©Ù¾ÛŒ Ù†Ø´Ø¯ â€” Ù…Ø±ÙˆØ±Ú¯Ø±Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ú©Ø±Ø¯.'));
  });

  // init
  handleDayBoundary();
  buildUI();
  updateCharts();
  checkAchievements();

  document.addEventListener('visibilitychange', ()=>{
    if(document.visibilityState === 'visible'){
      handleDayBoundary();
      buildUI();
      updateCharts();
      checkAchievements();
    }
  });
  </script>
</body>
</html>